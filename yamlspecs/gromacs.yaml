!include rcic-package.yaml
---
- package: GROMACS molecular dynamics 
  name: gromacs 
  baserpm: "{{name}}_{{version}}_{{compiler}}_{{compiler_version}}"
  versions: !include versions.yaml
  version: "{{versions.gromacs}}"
  release: 3
  builddir: build
  root: "{{pkg_defaults.app_path}}/{{name}}/{{version}}/{{compiler}}/{{compiler_version}}/node"
  compiler: "{{versions.compiler.name}}"
  compiler_version: "{{versions.compiler.version}}"
  vendor_source: ftp://ftp.gromacs.org/pub/gromacs/{{name}}-{{version}}.{{extension}}
  description: |
    GROMACS version {{version}}. Built with cmake arguments 
    {{build.cmake_args}}
  build:
    configure: "echo no configure. uses cmake" 
    modules: 
      - foundation
      - "{{compiler}}/{{compiler_version}}"
    cmake_args: -DGMX_BUILD_OWN_FFTW=ON -DCMAKE_INSTALL_PREFIX={{root}}
    pkgmake: > 
      mkdir {{builddir}};
      cd {{builddir}};
      cmake {{build.cmake_args}} ..;
      make -j 8
    target: 
  install:
     makeinstall: >
       cd {{builddir}};
       make DESTDIR=$(ROOT) install
     installextra: $(INSTALL) -m 644  README* COPYING AUTHORS $(ROOT){{root}} 
  requires:
    - "{{compiler}}_{{compiler_version}}"
  rpm: !include rpm.extras.yaml
