!include rcic-package.yaml
!include rpm.yaml
---
- package: LAMMPS Molecular Dynamics 
  name: lammps 
  release: 1
  basefamily: "{{name}}_{{version}}_{{compiler}}_{{compiler_version}}"
  baserpm: "{{basefamily}}"
  versions: !include versions.yaml
  version: "{{versions.lammps}}"
  mpi: "{{versions.mpi.name}}"
  mpi_version: "{{versions.mpi.version}}"
  mpi_module: "{{mpi}}/{{mpi_version}}/{{compiler}}.{{compiler_version}}"
  mpi_requires: "{{mpi}}_{{mpi_version}}_{{compiler}}_{{compiler_version}}"
  root: "{{pkg_defaults.app_path}}/{{name}}/{{version}}/{{compiler}}/{{compiler_version}}"
  compiler: "{{versions.compiler.name}}"
  compiler_version: "{{versions.compiler.version}}"
  vendor_source: https://github.com/lammps/lammps/archive/stable_{{version}}.{{extension}}
  src_dir: "{{name}}-stable_{{version}}"
  description: |
    LAMMPS version {{version}} - Large-scale Atomic/Molecular Massively Parallel
    Simulator. LAMMPS is a classical molecular dynamics simulation code designed to
    run efficiently on parallel computers.  It was developed at Sandia
    National Laboratories, a US Department of Energy facility, with
    funding from the DOE.  It is an open-source code, distributed freely
    under the terms of the GNU Public License (GPL)
  builddir: build
  build:
    configure: "no configure"
    configure_args: ""
    basemodules:
      - "{{compiler}}/{{compiler_version}}"
      - ffmpeg/{{versions.ffmpeg}}
    modules: 
      - "{{build.basemodules}}"
      - foundation 
      - "{{mpi_module}}"
    opt_args: "-DPKG_MOLECULE=on -DPKG_OPT=on"
    cmake_args: "-DBUILD_SHARED_LIBS=on -DBUILD_LIB=on -DCMAKE_INSTALL_PREFIX={{root}}"
    pkgmake: > 
      mkdir {{builddir}};
      cd {{builddir}};
      cmake {{build.opt_args}} {{build.cmake_args}} ../cmake;
      make -j 8 
    target: 
  install:
     makeinstall: >
       cd {{builddir}};
       make install DESTDIR=$(ROOT)
  requires:
    - "{{compiler}}_{{compiler_version}}"
    - ffmpeg_{{versions.ffmpeg}}
    - "{{mpi_requires}}"

# see ../README.md comments
